/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={175:t=>{"use strict";var e=/(?:https?:)?\/\/(?:(?:[\w-]+\.)+[\w/#@~.-]*)(?:\?(?:[\w&=.!,;$#%-]+)?)?/gi;t.exports=function(t){return(t||"").replace(e,(function(t){return'<a href="'+t+'">'+t+"</a>"}))}},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var s=r(397);function n(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function l(t,n,o,a){var i=n&&n.prototype instanceof p?n:p,l=Object.create(i.prototype);return s(l,"_invoke",function(t,s,n){var o,a,i,l=0,p=n||[],c=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return o=t,a=0,i=e,f.n=r,u}};function m(t,s){for(a=t,i=s,r=0;!c&&l&&!n&&r<p.length;r++){var n,o=p[r],m=f.p,d=o[2];t>3?(n=d===s)&&(i=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=m&&((n=t<2&&m<o[1])?(a=0,f.v=s,f.n=o[1]):m<d&&(n=t<3||o[0]>s||s>d)&&(o[4]=t,o[5]=s,f.n=d,a=0))}if(n||t>1)return u;throw c=!0,s}return function(n,p,d){if(l>1)throw TypeError("Generator is already running");for(c&&1===p&&m(p,d),a=p,i=d;(r=a<2?e:i)||!c;){o||(a?a<3?(a>1&&(f.n=-1),m(a,i)):f.n=i:f.v=i);try{if(l=2,o){if(a||(n="next"),r=o[n]){if(!(r=r.call(o,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(i=TypeError("The iterator does not provide a '"+n+"' method"),a=1);o=e}else if((r=(c=f.n<0)?i:t.call(s,f))!==u)break}catch(t){o=e,a=1,i=t}finally{l=1}}return{value:r,done:c}}}(t,o,a),!0),l}var u={};function p(){}function c(){}function f(){}r=Object.getPrototypeOf;var m=[][a]?r(r([][a]())):(s(r={},a,(function(){return this})),r),d=f.prototype=p.prototype=Object.create(m);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return c.prototype=f,s(d,"constructor",f),s(f,"constructor",c),c.displayName="GeneratorFunction",s(f,i,"GeneratorFunction"),s(d),s(d,i,"Generator"),s(d,a,(function(){return this})),s(d,"toString",(function(){return"[object Generator]"})),(t.exports=n=function(){return{w:l,m:g}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var s=r(312);t.exports=function(t,e,r,n,o){var a=s(t,e,r,n,o);return a.next().then((function(t){return t.done?t.value:a.next()}))},t.exports.__esModule=!0,t.exports.default=t.exports},312:(t,e,r)=>{var s=r(110),n=r(166);t.exports=function(t,e,r,o,a){return new n(s().w(t,e,r,o),a||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var s=r(163),n=r(397);t.exports=function t(e,r){function o(t,n,a,i){try{var l=e[t](n),u=l.value;return u instanceof s?r.resolve(u.v).then((function(t){o("next",t,a,i)}),(function(t){o("throw",t,a,i)})):r.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,i)}))}catch(t){i(t)}}var a;this.next||(n(t.prototype),n(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),n(this,"_invoke",(function(t,e,s){function n(){return new r((function(e,r){o(t,s,e,r)}))}return a=a?a.then(n,n):n()}),!0)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,s,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}t.exports=e=function(t,r,s,n){function o(r,s){e(t,r,(function(t){return this._invoke(r,s,t)}))}r?a?a(t,r,{value:s,enumerable:!n,configurable:!n,writable:!n}):t[r]=s:(o("next",0),o("throw",1),o("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,s,n,o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var s in e)r.unshift(s);return function t(){for(;r.length;)if((s=r.pop())in e)return t.value=s,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},24:(t,e,r)=>{var s=r(163),n=r(110),o=r(996),a=r(312),i=r(166),l=r(766),u=r(760);function p(){"use strict";var e=n(),r=e.m(p),c=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function f(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===c||"GeneratorFunction"===(e.displayName||e.name))}var m={throw:1,return:2,break:3,continue:3};function d(t){var e,r;return function(s){e||(e={stop:function(){return r(s.a,2)},catch:function(){return s.v},abrupt:function(t,e){return r(s.a,m[t],e)},delegateYield:function(t,n,o){return e.resultName=n,r(s.d,u(t),o)},finish:function(t){return r(s.f,t)}},r=function(t,r,n){s.p=e.prev,s.n=e.next;try{return t(r,n)}finally{e.next=s.n}}),e.resultName&&(e[e.resultName]=s.v,e.resultName=void 0),e.sent=s.v,e.next=s.n;try{return t.call(this,e)}finally{s.p=e.prev,s.n=e.next}}}return(t.exports=p=function(){return{wrap:function(t,r,s,n){return e.w(d(t),r,s,n&&n.reverse())},isGeneratorFunction:f,mark:e.m,awrap:function(t,e){return new s(t,e)},AsyncIterator:i,async:function(t,e,r,s,n){return(f(e)?a:o)(d(t),e,r,s,n)},keys:l,values:u}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=p,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var s=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(s(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var s=r(24)();t.exports=s;try{regeneratorRuntime=s}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}}},e={};function r(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{"use strict";r.r(s),r.d(s,{components:()=>T,extend:()=>G});const t=flarum.core.compat["admin/app"];var e=r.n(t);function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}const a=flarum.core.compat["common/components/Alert"];var i=r.n(a);const l=flarum.core.compat["admin/components/ExtensionPage"];var u=r.n(l);const p=flarum.core.compat["common/helpers/humanTime"];var c=r.n(p);const f=flarum.core.compat["common/utils/extractText"];var d=r.n(f);const g=flarum.core.compat["common/utils/ItemList"];var h=r.n(g);function v(t,e,r,s,n,o,a){try{var i=t[o](a),l=i.value}catch(t){return void r(t)}i.done?e(l):Promise.resolve(l).then(s,n)}var _=r(183),y=r.n(_);const b=flarum.core.compat["common/Component"];var x=function(t){function r(){for(var e,r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).testIP="8.8.8.8",e.testResult=null,e.testLoading=!1,e.testError=null,e}o(r,t);var s=r.prototype;return s.view=function(){return m("div",{className:"Section GeoipTest-testSection"},m("h3",null,e().translator.trans("fof-geoip.admin.settings.test.heading")),m("p",{className:"helpText"},e().translator.trans("fof-geoip.admin.settings.test.help")),this.testItems().toArray())},s.testItems=function(){var t=this,r=new(h());return r.add("test-service",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-geoip.admin.settings.test_service_label")),m("div",{className:"helpText"},e().translator.trans("fof-geoip.admin.settings.test_service_help")),m("div",{className:"GeoipTest-inputGroup"},m("input",{type:"text",className:"FormControl",value:this.testIP,placeholder:"8.8.8.8",onchange:function(e){t.testIP=e.target.value}}),m("button",{type:"button",className:"Button Button--primary",disabled:this.testLoading,onclick:this.testService.bind(this)},this.testLoading?e().translator.trans("fof-geoip.admin.settings.testing"):e().translator.trans("fof-geoip.admin.settings.test_button"))),this.testError&&m("div",{className:"Alert Alert--error GeoipTest-alert"},this.testError),this.testResult&&m("div",{className:"Alert "+(this.testResult.success?"Alert--success":"Alert--error")+" GeoipTest-alert"},m("h4",null,e().translator.trans("fof-geoip.admin.settings.test_result_title")),m("div",{className:"GeoipTest-resultHeader"},m("strong",null,e().translator.trans("fof-geoip.admin.settings.test_service_label_result"))," ",e().translator.trans("fof-geoip.admin.settings.service_"+this.testResult.service+"_label")||e().translator.trans("fof-geoip.admin.settings.status_unknown"),m("br",null),m("strong",null,e().translator.trans("fof-geoip.admin.settings.test_status_label"))," ",this.testResult.success?e().translator.trans("fof-geoip.admin.settings.status_success"):e().translator.trans("fof-geoip.admin.settings.status_error"),m("br",null),this.testResult.response_time_ms&&m("span",null,m("strong",null,e().translator.trans("fof-geoip.admin.settings.test_response_time_label"))," ",this.testResult.response_time_ms,"ms",m("br",null)),m("strong",null,e().translator.trans("fof-geoip.admin.settings.test_timestamp_label"))," ",this.testResult.timestamp),m("div",null,m("h5",null,e().translator.trans("fof-geoip.admin.settings.test_http_status_code_label")),m("div",{className:"GeoipTest-codeBlock"},this.testResult.http_status_code||e().translator.trans("fof-geoip.admin.settings.status_unknown")),!this.testResult.success&&this.testResult.error&&m("div",null,m("h5",null,e().translator.trans("fof-geoip.admin.settings.test_error_details_label")),m("pre",{className:"GeoipTest-codeBlock"},e().translator.trans("fof-geoip.admin.settings.error_prefix")," ",this.testResult.error,this.testResult.error_code&&"\n"+e().translator.trans("fof-geoip.admin.settings.error_code_prefix")+" "+this.testResult.error_code)),this.testResult.response_headers&&m("details",{className:"GeoipTest-details"},m("summary",{className:"GeoipTest-detailsSummary"},e().translator.trans("fof-geoip.admin.settings.response_headers_label")),m("pre",{className:"GeoipTest-codeBlock"},JSON.stringify(this.testResult.response_headers,null,2))),this.testResult.raw_http_response&&m("details",{className:"GeoipTest-details"},m("summary",{className:"GeoipTest-detailsSummary"},e().translator.trans("fof-geoip.admin.settings.raw_http_response_label")),m("pre",{className:"GeoipTest-codeBlock"},function(){try{var e=JSON.parse(t.testResult.raw_http_response);return JSON.stringify(e,null,2)}catch(e){return t.testResult.raw_http_response}}())),this.testResult.request_url&&m("details",{className:"GeoipTest-details"},m("summary",{className:"GeoipTest-detailsSummary"},e().translator.trans("fof-geoip.admin.settings.request_url_label")),m("pre",{className:"GeoipTest-codeBlock"},this.testResult.request_url)),this.testResult.request_options&&m("details",{className:"GeoipTest-details"},m("summary",{className:"GeoipTest-detailsSummary"},e().translator.trans("fof-geoip.admin.settings.request_options_label")),m("pre",{className:"GeoipTest-codeBlock"},JSON.stringify(this.testResult.request_options,null,2))),this.testResult.service_response&&m("div",null,m("h5",null,e().translator.trans("fof-geoip.admin.settings.test_processed_service_response_label")),m("pre",{className:"GeoipTest-codeBlock"},JSON.stringify(this.testResult.service_response,null,2))))))),r},s.testService=function(){var t,r=(t=y().mark((function t(){var r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.testIP.trim()){t.next=4;break}return this.testError=d()(e().translator.trans("fof-geoip.admin.settings.test_ip_required")),m.redraw(),t.abrupt("return");case 4:return this.testLoading=!0,this.testError=null,this.testResult=null,m.redraw(),t.prev=8,t.next=11,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/geoip/test?ip="+encodeURIComponent(this.testIP)});case 11:r=t.sent,this.testResult=r.data.attributes,t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),this.testError=(null==t.t0?void 0:t.t0.message)||e().translator.trans("fof-geoip.admin.settings.test_error"),this.testResult={success:!1,error:(null==t.t0?void 0:t.t0.message)||"Unknown error",httpStatus:(null==t.t0?void 0:t.t0.status)||null,responseText:(null==t.t0?void 0:t.t0.responseText)||null};case 19:return t.prev=19,this.testLoading=!1,m.redraw(),t.finish(19);case 23:case"end":return t.stop()}}),t,this,[[8,15,19,23]])})),function(){var e=this,r=arguments;return new Promise((function(s,n){var o=t.apply(e,r);function a(t){v(o,s,n,a,i,"next",t)}function i(t){v(o,s,n,a,i,"throw",t)}a(void 0)}))});return function(){return r.apply(this,arguments)}}(),r}(r.n(b)()),N=r(175),w=r.n(N),S=function(t){function r(){return t.apply(this,arguments)||this}o(r,t);var s=r.prototype;return s.content=function(){var t=this.setting("fof-geoip.service")(),r=1e3*Number(e().data.settings["fof-geoip.services."+t+".last_error_time"]),s=e().data.settings["fof-geoip.services."+t+".error"];return m("div",{className:"GeoipSettingsPage"},m("div",{className:"container"},m("div",{className:"GeoipSettingsTabPage GeoipSettingsPage--settings"},m("div",{className:"Form"},s&&m(i(),{className:"Form-group",dismissable:!1},m("b",{style:{textTransform:"uppercase",marginRight:"5px"}},c()(new Date(r))),s),this.settingsItems().toArray(),m("div",{className:"Form-group"},this.submitButton()),m(x,null)))))},s.settingsItems=function(){var t=new(h());return t.add("general",m("div",{className:"Section"},m("h3",null,e().translator.trans("fof-geoip.admin.settings.general.heading")),m("p",{className:"helpText"},e().translator.trans("fof-geoip.admin.settings.general.help")),this.generalItems().toArray())),t.add("providers",m("div",{className:"Section"},m("h3",null,e().translator.trans("fof-geoip.admin.settings.providers.heading")),m("p",{className:"helpText"},e().translator.trans("fof-geoip.admin.settings.providers.help")),this.providerItems().toArray())),t},s.generalItems=function(){var t=new(h());return t.add("show-flags",this.buildSettingComponent({setting:"fof-geoip.showFlag",type:"boolean",label:e().translator.trans("fof-geoip.admin.settings.show_flag_label"),help:e().translator.trans("fof-geoip.admin.settings.show_flag_help")})),t},s.providerItems=function(){var t=new(h()),r=this.setting("fof-geoip.service")();return t.add("service",this.buildSettingComponent({type:"select",setting:"fof-geoip.service",label:e().translator.trans("fof-geoip.admin.settings.service_label"),options:e().data["fof-geoip.services"].reduce((function(t,r){return t[r]=d()(e().translator.trans("fof-geoip.admin.settings.service_"+r+"_label")),t}),{}),required:!0,help:r&&m.trust(w()(d()(e().translator.trans("fof-geoip.admin.settings.service_"+r+"_description"))))})),["ipdata","ipapi-pro","ipsevenex","ipinfo-lite"].includes(r)&&t.add("api-key",this.buildSettingComponent({type:"string",setting:"fof-geoip.services."+r+".access_key",label:e().translator.trans("fof-geoip.admin.settings.access_key_label"),required:!0})),"ipdata"===r&&t.add("ipdata-quota",this.buildSettingComponent({type:"number",setting:"fof-geoip.services.ipdata.quota",label:e().translator.trans("fof-geoip.admin.settings.quota_label"),min:1500,placeholder:1500})),t},r}(u()),T={GeoipSettingsPage:S};const G=[].concat([]);e().initializers.add("fof/geoip",(function(){e().extensionData.for("fof-geoip").registerPage(S).registerPermission({icon:"fas fa-globe",permission:"fof-geoip.canSeeCountry",label:e().translator.trans("fof-geoip.admin.permissions.see_country")},"moderate",50)}))})(),module.exports=s})();
//# sourceMappingURL=admin.js.map